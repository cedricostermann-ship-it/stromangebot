<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tarifwechsel24 ‚Äì Stromangebot</title>

  <style>
    :root{
      /* ‚úÖ Deine CI (wie Formular) */
      --bg:#f6f0e6;
      --card:#ffffff;
      --text:#101828;
      --muted:#475467;
      --border:rgba(16,24,40,.18);
      --primary:#0070D7;   /* Blau */
      --green:#66b21d;     /* Gr√ºn */
      --radius:16px;
    }

    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    .wrap{max-width:920px;margin:0 auto;padding:16px;}

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(0,0,0,.06);
      padding:22px;
    }

    /* Form */
    .progress{
      height:6px;
      background:rgba(0,0,0,.06);
      border-radius:999px;
      overflow:hidden;
      margin:0 0 18px;
    }
    .bar{height:100%;width:0;background:var(--primary);transition:width .25s ease;}

    h1{
      font-size:28px;
      line-height:1.15;
      margin:0 0 10px;
      letter-spacing:-0.01em;
    }
    .h1line{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .sub{color:var(--muted);margin:0;}
    .spacer{height:12px;}

    label{display:block;font-weight:800;margin:14px 0 8px;}
    input{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:16px;
      outline:none;
      background:#fff;
    }
    input:focus{
      border-color:rgba(0,112,215,.55);
      box-shadow:0 0 0 4px rgba(0,112,215,.12);
    }

    .btnrow{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap;}
    .btnrow button{width:100%;}
    .btnrow.nav{flex-wrap:nowrap;align-items:stretch;}
    .btnrow.nav button{width:auto;flex:1;}

    button{
      border:0;
      border-radius:12px;
      padding:14px 14px;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
    }
    .primary{background:var(--primary);color:white;}
    .ghost{background:#f2f4f7;color:var(--text);}
    .primary:active,.ghost:active{transform:translateY(1px);}

    .choices{display:flex;flex-direction:column;gap:12px;margin-top:6px;}
    .chip{
      width:100%;
      border:1px solid var(--border);
      background:#fff;
      border-radius:14px;
      padding:14px 14px;
      cursor:pointer;
      font-weight:900;
      text-align:left;
      box-shadow:0 1px 0 rgba(16,24,40,.04);
    }
    .chip[data-active="true"]{
      border-color:rgba(0,112,215,.55);
      box-shadow:0 0 0 4px rgba(0,112,215,.12);
      background:rgba(0,112,215,.06);
    }

    .error{
      color:#b42318;
      background:#fef3f2;
      border:1px solid #fecdca;
      border-radius:12px;
      padding:10px;
      margin-top:12px;
      display:none;
      font-weight:800;
    }
    .small{font-size:13px;color:var(--muted);margin-top:10px}
    .check{display:flex;gap:10px;align-items:flex-start;margin-top:14px}
    .check input{width:auto;margin-top:3px}
    a{color:var(--primary);text-decoration:underline;}
    .hidden{display:none;}

    /* =========================================================
       ‚úÖ BELOW-FORM SECTION ‚Äî "besondere" Optik, aber in deiner CI
       Hintergrund bleibt beige (var(--bg)), keine Navy/Yellow mehr
       ========================================================= */
    .tw24-below{
      margin-top:18px;
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(16,24,40,.12);
      background:
        radial-gradient(900px 320px at 15% 10%, rgba(0,112,215,.08), transparent 60%),
        radial-gradient(700px 320px at 85% 15%, rgba(102,178,29,.08), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.30), rgba(255,255,255,.10));
      box-shadow:0 14px 40px rgba(0,0,0,.08);
      position:relative;
    }

    .tw24-below-inner{
      padding:24px 22px 18px;
    }

    .tw24-hero{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:16px;
      align-items:stretch;
    }

    .tw24-hero-title{
      margin:0 0 10px;
      font-size:30px;
      line-height:1.1;
      letter-spacing:-0.02em;
      color:var(--text);
    }

    .tw24-accent-green{ color: var(--green); }
    .tw24-accent-blue{ color: var(--primary); }

    .tw24-hero-sub{
      margin:0 0 14px;
      color:var(--muted);
      font-weight:650;
    }

    .tw24-pills{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:10px;
    }

    .tw24-pill{
      display:flex;
      align-items:center;
      gap:12px;
      background:rgba(255,255,255,.92);
      border:1px solid rgba(16,24,40,.12);
      border-radius:999px;
      padding:14px 16px;
      font-weight:900;
      box-shadow:0 10px 26px rgba(0,0,0,.08);
    }

    .tw24-pill-ico{
      width:32px;height:32px;
      border-radius:14px;
      display:grid;place-items:center;
      border:1px solid rgba(16,24,40,.10);
      background:rgba(0,112,215,.08);
      color:var(--primary);
      flex:0 0 auto;
      font-weight:900;
    }
    .tw24-pill-ico.green{
      background:rgba(102,178,29,.12);
      color:var(--green);
    }

    .tw24-hero-cta{
      display:inline-block;
      margin-top:14px;
      color:var(--primary);
      font-weight:900;
      text-decoration:none;
      border-bottom:2px solid rgba(0,112,215,.25);
    }
    .tw24-hero-cta:hover{ border-bottom-color:rgba(0,112,215,.45); }

    .tw24-trust{
      margin-top:10px;
      color:var(--muted);
      font-weight:800;
      font-size:13px;
    }

    /* Right illustration card - light, CI-friendly */
    .tw24-illus-card{
      border-radius:20px;
      border:1px solid rgba(16,24,40,.12);
      background:
        radial-gradient(260px 220px at 30% 30%, rgba(0,112,215,.14), transparent 60%),
        radial-gradient(260px 220px at 70% 70%, rgba(102,178,29,.14), transparent 60%),
        rgba(255,255,255,.70);
      box-shadow:0 14px 34px rgba(0,0,0,.10);
      position:relative;
      overflow:hidden;
      min-height:260px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }

    .tw24-illus{
      width:100%;
      max-width:420px;
      height:auto;
      display:block;
      opacity:.95;
    }

    .tw24-illus-badge{
      position:absolute;
      left:14px;
      bottom:14px;
      background:rgba(255,255,255,.90);
      border:1px solid rgba(16,24,40,.12);
      border-radius:16px;
      padding:10px 12px;
      color:var(--text);
      box-shadow:0 10px 26px rgba(0,0,0,.10);
    }
    .tw24-illus-badge-top{ font-weight:950; }
    .tw24-illus-badge-sub{ font-weight:750; color:var(--muted); font-size:13px; }

    /* Steps / Timeline */
    .tw24-steps{
      margin-top:18px;
      padding-top:16px;
      border-top:1px solid rgba(16,24,40,.10);
    }

    .tw24-steps-title{
      margin:0 0 14px;
      text-align:center;
      color:var(--text);
      font-size:28px;
      letter-spacing:-0.02em;
    }

    .tw24-steps-title .em{
      color:var(--green);
    }

    .tw24-timeline{
      position:relative;
      padding:10px 0 6px;
      display:grid;
      gap:16px;
    }

    @media (min-width: 760px){
      .tw24-timeline::before{
        content:"";
        position:absolute;
        top:0; bottom:0;
        left:50%;
        width:2px;
        background:rgba(16,24,40,.12);
        transform:translateX(-1px);
      }
    }

    .tw24-stepcard{
      display:flex;
      gap:12px;
      align-items:flex-start;
      background:rgba(255,255,255,.92);
      border-radius:18px;
      padding:16px 16px;
      border:1px solid rgba(16,24,40,.12);
      box-shadow:0 12px 30px rgba(0,0,0,.08);
      max-width:440px;
    }

    .tw24-dot{
      width:34px; height:34px;
      border-radius:999px;
      display:grid; place-items:center;
      background:var(--primary);
      color:#fff;
      font-weight:950;
      flex:0 0 auto;
      box-shadow:0 10px 22px rgba(0,0,0,.14);
    }
    .tw24-dot.green{
      background:var(--green);
    }

    .tw24-step-head{ font-weight:950; }
    .tw24-step-sub{ margin-top:4px; color:var(--muted); font-weight:650; }

    @media (min-width: 760px){
      .tw24-stepcard:nth-child(odd){ margin-right:auto; }
      .tw24-stepcard:nth-child(even){ margin-left:auto; }
    }

    .tw24-steps-foot{
      margin-top:12px;
      text-align:center;
      color:var(--muted);
      font-weight:850;
      font-size:13px;
    }

    @media (max-width: 759px){
      .tw24-hero{ grid-template-columns: 1fr; }
      .tw24-hero-title{ font-size:26px; }
      .tw24-steps-title{ font-size:24px; }
      .tw24-stepcard{ max-width:100%; }
    }

    @media (max-width:420px){
      .btnrow.nav{flex-wrap:wrap;}
      .btnrow.nav button{flex:unset;width:100%;}
      h1{font-size:24px;}
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- FORM CARD -->
    <div class="card" id="top">
      <div class="progress"><div class="bar" id="bar"></div></div>
      <div id="err" class="error"></div>

      <!-- STEP 1 -->
      <section class="stepview" data-step="1">
        <h1 class="h1line">üîç Ihr pers√∂nliches Stromangebot in 2&nbsp;Minuten ‚ö°</h1>
        <p class="sub">Kostenlos ¬∑ unverbindlich ¬∑ pers√∂nlich gepr√ºft</p>
        <div class="spacer"></div>

        <label for="plz">üëâ Postleitzahl</label>
        <input id="plz" inputmode="numeric" autocomplete="postal-code" placeholder="z. B. 10115" maxlength="5" />

        <div class="btnrow">
          <button class="primary" id="to2">Weiter ‚Üí</button>
        </div>
      </section>

      <!-- STEP 2 -->
      <section class="stepview hidden" data-step="2">
        <h1>Sind Sie Privat- oder Gewerbekunde?</h1>
        <p class="sub">Gewerbe- und Privatkunden haben unterschiedliche Tarife & Konditionen.</p>
        <div class="spacer"></div>

        <div class="choices" id="customerType">
          <div class="chip" data-value="Privat">Privat</div>
          <div class="chip" data-value="Gewerbe">Gewerbe</div>
        </div>

        <div class="btnrow nav">
          <button class="ghost" id="back1">‚Üê Zur√ºck</button>
          <button class="primary" id="to3">Weiter ‚Üí</button>
        </div>
      </section>

      <!-- STEP 3 PRIVAT -->
      <section class="stepview hidden" data-step="3p">
        <h1 class="h1line">Wie hoch ist Ihr j√§hrlicher Stromverbrauch?</h1>
        <p class="sub">Falls Sie es nicht genau wissen: grobe Sch√§tzung reicht.</p>
        <div class="spacer"></div>

        <div class="choices" id="usagePrivate">
          <div class="chip" data-value="Bis 2.000 kWh">Bis 2.000 kWh</div>
          <div class="chip" data-value="2.000 ‚Äì 3.500 kWh">2.000 ‚Äì 3.500 kWh</div>
          <div class="chip" data-value="3.500 ‚Äì 5.000 kWh">3.500 ‚Äì 5.000 kWh</div>
          <div class="chip" data-value="√úber 5.000 kWh">√úber 5.000 kWh</div>
          <div class="chip" data-value="Wei√ü ich nicht">Wei√ü ich nicht</div>
        </div>

        <div class="btnrow nav">
          <button class="ghost" id="back2a">‚Üê Zur√ºck</button>
          <button class="primary" id="to4a">Weiter ‚Üí</button>
        </div>
      </section>

      <!-- STEP 3 GEWERBE -->
      <section class="stepview hidden" data-step="3g">
        <h1 class="h1line">Wie hoch ist Ihr j√§hrlicher Stromverbrauch?</h1>
        <p class="sub">Richtwert gen√ºgt ‚Äì wir kl√§ren Details im Gespr√§ch.</p>
        <div class="spacer"></div>

        <div class="choices" id="usageBusiness">
          <div class="chip" data-value="Bis 50.000 kWh">Bis 50.000 kWh</div>
          <div class="chip" data-value="50.000 ‚Äì 100.000 kWh">50.000 ‚Äì 100.000 kWh</div>
          <div class="chip" data-value="√úber 100.000 kWh">√úber 100.000 kWh</div>
        </div>

        <div class="btnrow nav">
          <button class="ghost" id="back2b">‚Üê Zur√ºck</button>
          <button class="primary" id="to4b">Weiter ‚Üí</button>
        </div>
      </section>

      <!-- STEP 4 CONTACT -->
      <section class="stepview hidden" data-step="4">
        <h1 class="h1line">‚ö° Fast geschafft ‚Äì wir erstellen jetzt Ihr Stromangebot</h1>
        <p class="sub">Ein Energieberater meldet sich kurz, um die besten Optionen zu best√§tigen.</p>
        <div class="spacer"></div>

        <label for="name">Vor- & Nachname *</label>
        <input id="name" autocomplete="name" placeholder="Max Mustermann" />

        <label for="phone">Telefonnummer *</label>
        <input id="phone" inputmode="tel" autocomplete="tel" placeholder="0176 12345678" />

        <label>Wie m√∂chten Sie kontaktiert werden? (optional)</label>
        <div class="choices" id="contactPref">
          <div class="chip" data-value="Telefon">Telefon</div>
          <div class="chip" data-value="WhatsApp">WhatsApp</div>
          <div class="chip" data-value="E-Mail">E-Mail</div>
        </div>

        <div class="check">
          <input id="consent" type="checkbox" />
          <div class="small">
            Ich willige ein, dass meine Angaben zur Erstellung eines Stromangebots verarbeitet werden und ich hierzu telefonisch,
            per WhatsApp oder per E-Mail kontaktiert werde. Weitere Informationen in der
            <a href="/datenschutz" target="_blank" rel="noopener">Datenschutzerkl√§rung</a>.
            <span style="color:#b42318;">*</span>
          </div>
        </div>

        <div class="btnrow nav">
          <button class="ghost" id="back3">‚Üê Zur√ºck</button>
          <button class="primary" id="submit">Stromangebot anfordern ‚Üí</button>
        </div>

        <div class="small">Kostenlos & unverbindlich. Kein Spam.</div>
      </section>

      <!-- THANK YOU -->
      <section class="stepview hidden" data-step="5">
        <h1>‚úÖ Danke! Anfrage erhalten.</h1>
        <p class="sub">Unser Energieberater setzt sich in K√ºrze mit Ihnen in Verbindung.</p>
        <div class="spacer"></div>

        <div class="btnrow">
          <a class="primary"
             style="display:inline-block;text-decoration:none;padding:14px 14px;border-radius:12px;width:100%;font-weight:900;text-align:center;"
             id="waLink" href="#" target="_blank" rel="noopener">Optional: per WhatsApp schreiben</a>
        </div>

        <div class="spacer"></div>
        <div class="small">Hinweis: WhatsApp ist freiwillig.</div>
      </section>
    </div>

    <!-- ‚úÖ BELOW FORM (CI-friendly, beige background stays) -->
    <section class="tw24-below" id="howitworks">
      <div class="tw24-below-inner">

        <div class="tw24-hero">
          <div>
            <h2 class="tw24-hero-title">
              Deswegen setzen so viele auf <span class="tw24-accent-green">Tarifwechsel24</span>
            </h2>
            <p class="tw24-hero-sub">
              Verst√§ndlich, pers√∂nlich und ohne unn√∂tigen Aufwand ‚Äì <b>kostenlos</b> & unverbindlich.
            </p>

            <div class="tw24-pills">
              <div class="tw24-pill">
                <span class="tw24-pill-ico green">üåø</span>
                <span>Nachhaltig weniger bezahlen</span>
              </div>
              <div class="tw24-pill">
                <span class="tw24-pill-ico">üîÅ</span>
                <span>Automatischer Wechsel, kein Aufwand</span>
              </div>
              <div class="tw24-pill">
                <span class="tw24-pill-ico">üéß</span>
                <span>Pers√∂nlicher Support</span>
              </div>
              <div class="tw24-pill">
                <span class="tw24-pill-ico green">‚úÖ</span>
                <span>Pers√∂nlich gepr√ºft ‚Äì kein Algorithmus-Blindflug</span>
              </div>
            </div>

            <a class="tw24-hero-cta" href="#top">Zum Formular ‚Üë</a>
            <div class="tw24-trust">Kostenlos ¬∑ unverbindlich ¬∑ kein Spam</div>
          </div>

          <div>
            <div class="tw24-illus-card">
              <!-- Light, neutral illustration placeholder (CI-fit). Replace anytime with an image. -->
              <svg viewBox="0 0 520 360" class="tw24-illus" aria-hidden="true">
                <defs>
                  <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0" stop-color="rgba(0,112,215,.20)"/>
                    <stop offset="1" stop-color="rgba(102,178,29,.18)"/>
                  </linearGradient>
                </defs>

                <rect x="20" y="22" width="480" height="316" rx="22" fill="rgba(255,255,255,.55)" stroke="rgba(16,24,40,.12)" />
                <rect x="48" y="56" width="424" height="232" rx="18" fill="url(#g)" opacity=".35" />

                <circle cx="118" cy="128" r="44" fill="rgba(16,24,40,.10)"/>
                <rect x="190" y="96" width="240" height="22" rx="11" fill="rgba(16,24,40,.12)"/>
                <rect x="190" y="132" width="200" height="16" rx="8" fill="rgba(16,24,40,.10)"/>
                <rect x="190" y="162" width="220" height="16" rx="8" fill="rgba(16,24,40,.10)"/>

                <rect x="92" y="214" width="336" height="52" rx="16" fill="rgba(255,255,255,.55)" stroke="rgba(16,24,40,.12)"/>
                <text x="115" y="246" font-size="16" fill="rgba(16,24,40,.72)" font-family="system-ui, -apple-system, Segoe UI, Roboto">
                  Jahresabrechnung ‚úì
                </text>
              </svg>

              <div class="tw24-illus-badge">
                <div class="tw24-illus-badge-top">Schnell gepr√ºft</div>
                <div class="tw24-illus-badge-sub">in wenigen Minuten</div>
              </div>
            </div>
          </div>
        </div>

        <div class="tw24-steps">
          <h3 class="tw24-steps-title">So <span class="em">einfach</span> geht‚Äôs</h3>

          <div class="tw24-timeline">
            <div class="tw24-stepcard">
              <div class="tw24-dot">1</div>
              <div>
                <div class="tw24-step-head">Gespr√§ch vereinbaren</div>
                <div class="tw24-step-sub">Kurz Daten angeben ‚Äì wir melden uns pers√∂nlich.</div>
              </div>
            </div>

            <div class="tw24-stepcard">
              <div class="tw24-dot green">2</div>
              <div>
                <div class="tw24-step-head">Angebot bekommen</div>
                <div class="tw24-step-sub">Passende Tarife f√ºr Ihre Situation ‚Äì verst√§ndlich erkl√§rt.</div>
              </div>
            </div>

            <div class="tw24-stepcard">
              <div class="tw24-dot">3</div>
              <div>
                <div class="tw24-step-head">Wechsel erledigen</div>
                <div class="tw24-step-sub">Wenn alles passt: Wir unterst√ºtzen ‚Äì transparent & stressfrei.</div>
              </div>
            </div>
          </div>

          <div class="tw24-steps-foot">Kostenlos & unverbindlich ¬∑ Pers√∂nlich gepr√ºft</div>
        </div>

      </div>
    </section>

  </div>

  <script>
    const WEBHOOK_URL = "PASTE_YOUR_WEBHOOK_URL_HERE";
    const WA_NUMBER = "4917672530039";

    const state = { plz:"", type:"", usage:"", name:"", phone:"", pref:"" };

    const $ = (id) => document.getElementById(id);
    const steps = Array.from(document.querySelectorAll(".stepview"));
    const err = $("err");
    const bar = $("bar");

    function showError(msg){
      err.textContent = msg;
      err.style.display = "block";
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
    function clearError(){ err.style.display = "none"; err.textContent=""; }

    function setActive(containerId, value){
      const el = $(containerId);
      el.querySelectorAll(".chip").forEach(c => c.dataset.active = (c.dataset.value === value) ? "true" : "false");
    }

    function currentProgress(stepKey){
      const map = { "1": 20, "2": 40, "3p": 60, "3g": 60, "4": 85, "5": 100 };
      bar.style.width = (map[stepKey] || 0) + "%";
    }

    function sendEmbedHeight(){
      const wrap = document.querySelector(".wrap");
      const section = document.getElementById("howitworks");
      const card = document.querySelector(".card");
      if(!wrap || !card) return;

      const wrapRect = wrap.getBoundingClientRect();
      const lastRect = (section ? section.getBoundingClientRect() : card.getBoundingClientRect());
      const h = Math.ceil((lastRect.bottom - wrapRect.top) + 16);

      window.parent && window.parent.postMessage({ type: "TW24_HEIGHT", height: h }, "*");
    }

    function go(stepKey){
      clearError();
      steps.forEach(s => s.classList.add("hidden"));
      document.querySelector(`.stepview[data-step="${stepKey}"]`).classList.remove("hidden");
      currentProgress(stepKey);

      setTimeout(sendEmbedHeight, 20);
      setTimeout(sendEmbedHeight, 120);
    }

    $("customerType").addEventListener("click", (e)=>{
      const chip = e.target.closest(".chip"); if(!chip) return;
      state.type = chip.dataset.value;
      setActive("customerType", state.type);
      setTimeout(sendEmbedHeight, 20);
    });

    $("usagePrivate").addEventListener("click", (e)=>{
      const chip = e.target.closest(".chip"); if(!chip) return;
      state.usage = chip.dataset.value;
      setActive("usagePrivate", state.usage);
      setTimeout(sendEmbedHeight, 20);
    });

    $("usageBusiness").addEventListener("click", (e)=>{
      const chip = e.target.closest(".chip"); if(!chip) return;
      state.usage = chip.dataset.value;
      setActive("usageBusiness", state.usage);
      setTimeout(sendEmbedHeight, 20);
    });

    $("contactPref").addEventListener("click", (e)=>{
      const chip = e.target.closest(".chip"); if(!chip) return;
      state.pref = chip.dataset.value;
      setActive("contactPref", state.pref);
      setTimeout(sendEmbedHeight, 20);
    });

    $("to2").onclick = () => {
      const plz = $("plz").value.trim();
      if(!/^\d{5}$/.test(plz)) return showError("Bitte eine g√ºltige Postleitzahl (5 Ziffern) eingeben.");
      state.plz = plz;
      go("2");
    };

    $("back1").onclick = () => go("1");

    $("to3").onclick = () => {
      if(!state.type) return showError("Bitte w√§hlen Sie Privat oder Gewerbe.");
      if(state.type === "Privat") go("3p"); else go("3g");
    };

    $("back2a").onclick = () => go("2");
    $("back2b").onclick = () => go("2");

    $("to4a").onclick = () => {
      if(!state.usage) return showError("Bitte w√§hlen Sie eine Verbrauchsangabe.");
      go("4");
    };
    $("to4b").onclick = () => {
      if(!state.usage) return showError("Bitte w√§hlen Sie eine Verbrauchsangabe.");
      go("4");
    };

    $("back3").onclick = () => {
      if(state.type === "Privat") go("3p"); else go("3g");
    };

    $("submit").onclick = async () => {
      state.name = $("name").value.trim();
      state.phone = $("phone").value.trim();
      const consent = $("consent").checked;

      if(!state.name) return showError("Bitte Vor- & Nachname eintragen.");
      if(state.phone.length < 6) return showError("Bitte eine g√ºltige Telefonnummer eintragen.");
      if(!consent) return showError("Bitte best√§tigen Sie die Datenschutzeinwilligung.");

      const payload = {
        plz: state.plz,
        kundentyp: state.type,
        verbrauch: state.usage,
        name: state.name,
        telefon: state.phone,
        kontaktpraeferenz: state.pref || "",
        timestamp: new Date().toISOString(),
        source: location.href
      };

      const msg = encodeURIComponent(`Hi, ich habe gerade ein Stromangebot angefordert. PLZ: ${state.plz}`);
      $("waLink").href = `https://wa.me/${WA_NUMBER}?text=${msg}`;

      try{
        if(WEBHOOK_URL && WEBHOOK_URL.startsWith("http")){
          await fetch(WEBHOOK_URL, {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify(payload),
            keepalive: true
          });
        }
        go("5");
      }catch(e){
        showError("Ups ‚Äì technisch gab es kurz ein Problem. Bitte versuchen Sie es erneut oder kontaktieren Sie uns direkt.");
        console.error(e);
      }
    };

    window.addEventListener("load", () => {
      go("1");
      setTimeout(sendEmbedHeight, 120);
    });
    window.addEventListener("resize", () => setTimeout(sendEmbedHeight, 80));
  </script>
</body>
</html>
